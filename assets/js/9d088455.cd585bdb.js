"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[3214],{2964:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>l,contentTitle:()=>r,default:()=>d,frontMatter:()=>a,metadata:()=>o,toc:()=>h});var n=i(4848),s=i(8453);const a={},r="Node Client",o={id:"alert-trigger/node-client/index",title:"Node Client",description:"Using the Notifi Node SDK, developers are provided with a very flexible and custom alert triggering tool where the Dapp",source:"@site/versioned_docs/version-Release/alert-trigger/node-client/index.md",sourceDirName:"alert-trigger/node-client",slug:"/alert-trigger/node-client/",permalink:"/docs/alert-trigger/node-client/",draft:!1,unlisted:!1,editUrl:"https://github.com/notifi-network/notifi-network.github.io/blob/main/versioned_docs/version-Release/alert-trigger/node-client/index.md",tags:[],version:"Release",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Dataplane API",permalink:"/docs/alert-trigger/dataplane-api/"},next:{title:"Displaying Notification History",permalink:"/docs/notification-history/"}},l={},h=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Creating a client",id:"creating-a-client",level:2},{value:"Login",id:"login",level:2},{value:"publishFusionMessage",id:"publishfusionmessage",level:2},{value:"Ensuring only wallet owners receive notifications",id:"publish-secure",level:3},{value:"Requirements for topics that have alert filters",id:"requirements-for-topics-that-have-alert-filters",level:3},{value:"Topic that emits ETH balance changes",id:"topic-that-emits-eth-balance-changes",level:4},{value:"This shows a case where this user&#39;s alert would get triggered by your backend publishing a message. The subscription value matches (ignoring case) and the threshold value is above what the alert was configured for. If either of those conditions failed, the alert would not trigger.",id:"this-shows-a-case-where-this-users-alert-would-get-triggered-by-your-backend-publishing-a-message-the-subscription-value-matches-ignoring-case-and-the-threshold-value-is-above-what-the-alert-was-configured-for-if-either-of-those-conditions-failed-the-alert-would-not-trigger",level:5},{value:"Topic that emits sensitive account updates",id:"topic-that-emits-sensitive-account-updates",level:4},{value:"This shows a case where this user&#39;s alert would get triggered by your backend publishing a message. An alert matching the eventTypeId that you provided was found for the user owning wallet 0xA4d2C123. Finally, the threshold value is above what the alert was configured for, so the alert will trigger. If multiple &#39;specificWallets&#39; were to be provided, all of those users would have alerts searched for matching the criteria.",id:"this-shows-a-case-where-this-users-alert-would-get-triggered-by-your-backend-publishing-a-message-an-alert-matching-the-eventtypeid-that-you-provided-was-found-for-the-user-owning-wallet-0xa4d2c123-finally-the-threshold-value-is-above-what-the-alert-was-configured-for-so-the-alert-will-trigger-if-multiple-specificwallets-were-to-be-provided-all-of-those-users-would-have-alerts-searched-for-matching-the-criteria",level:5}];function c(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.h1,{id:"node-client",children:"Node Client"}),"\n",(0,n.jsxs)(t.p,{children:["Using the Notifi Node SDK, developers are provided with a very flexible and custom alert triggering tool where the Dapp\nfully owns the decision of when to send out notifications. After configuring alert topics and templates in the\n",(0,n.jsx)(t.a,{href:"https://admin.notifi.network",children:"Notifi Admin Portal"}),", developers can utilize the Notifi Node SDK to send notifications.\nExample use cases for this include triggering notifications based on off-chain events, or watching a chain in a\nself-hosted setup."]}),"\n",(0,n.jsxs)(t.p,{children:["The Notifi Node SDK is available on ",(0,n.jsx)(t.a,{href:"https://github.com/notifi-network/notifi-sdk-ts/tree/main/packages/notifi-node",children:"Github"}),"."]}),"\n",(0,n.jsx)(t.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,n.jsxs)(t.p,{children:["In order to use the Node SDK to publish notifications, you first need to set up the following on the\n",(0,n.jsx)(t.a,{href:"https://admin.notifi.network",children:"Notifi Admin Portal"}),":"]}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"A Dapp account (an account created on Admin Portal, NOT the Notifi Hub)"}),"\n",(0,n.jsxs)(t.li,{children:["A ",(0,n.jsx)(t.a,{href:"/docs/create-topics/api-triggered",children:'"Sent from my server" topic'}),", created in Alert Manager"]}),"\n",(0,n.jsx)(t.li,{children:"One or more subscriptions for users on that topic"}),"\n",(0,n.jsxs)(t.li,{children:["A ",(0,n.jsx)(t.a,{href:"/docs/styling-your-notifications/",children:"set of templates on that topic"})," for each messaging platform you want to support"]}),"\n"]}),"\n",(0,n.jsx)(t.p,{children:"When you have these things, you will be able to copy the SID and SECRET for your Dapp account\nunder Account Settings, and the Event Type ID from your topic."}),"\n",(0,n.jsx)(t.h2,{id:"creating-a-client",children:"Creating a client"}),"\n",(0,n.jsx)(t.p,{children:"First, instantiate a client in your Node application:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-javascript",children:"import {\n  NotifiClient,\n  NotifiEnvironment,\n  createNotifiService, \n  createDataplaneClient, \n  createGraphQLClient,\n} from '@notifi-network/notifi-node';\n\nconst env: NotifiEnvironment = 'Production';\nconst gqlClient = createGraphQLClient(env);\nconst notifiService = createNotifiService(gqlClient);\nconst dataplaneApiClient = createDataplaneClient(env);\nconst client = new NotifiClient(notifiService, dataplaneApiClient);\n"})}),"\n",(0,n.jsx)(t.h2,{id:"login",children:"Login"}),"\n",(0,n.jsxs)(t.p,{children:["Once you've created your client, log in using the SID and SECRET for your Dapp account,\nwhich can be found under Account Settings in the ",(0,n.jsx)(t.a,{href:"https://admin.notifi.network/",children:"Admin Console"}),":"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-javascript",children:"const MY_SID = process.env.MY_SID;\nconst MY_SECRET = process.env.MY_SECRET;\nconst { token, expiry } = await client.logIn({\n    sid: MY_SID,\n    secret: MY_SECRET\n})\n"})}),"\n",(0,n.jsxs)(t.p,{children:["The returned ",(0,n.jsx)(t.code,{children:"token"})," is a ",(0,n.jsx)(t.a,{href:"https://jwt.io",children:"JavaScript Web Token"})," that you will use to authenticate\nall other requests made by your Node application."]}),"\n",(0,n.jsx)(t.h2,{id:"publishfusionmessage",children:"publishFusionMessage"}),"\n",(0,n.jsxs)(t.p,{children:["Once you have a token, you can then use it to publish messages to your topic. This is done through the\n",(0,n.jsx)(t.code,{children:"NotifiClient.publishFusionMessage"})," API."]}),"\n",(0,n.jsxs)(t.p,{children:["To send a message to ",(0,n.jsx)(t.strong,{children:"everyone"})," subscribed to a particular topic, use the call below:"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-javascript",children:'await client.publishFusionMessage(token, [{\n    eventTypeId: "abc123",\n    variablesJson: {\n        message: "Hello from Notifi!",\n        items: [\n            1,\n            2,\n            3    \n        ]\n    }\n}]);\n'})}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"eventTypeId"}),': The "Event Type ID" associated with the topic you\'re publishing to.']}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"variablesJson"}),": A bundle of JSON-serializable variables to be used during rendering\nof your message templates. This variable presents itself in your templates as ",(0,n.jsx)(t.code,{children:"eventData"})," -\ne.g. the expression ",(0,n.jsx)(t.code,{children:"{{eventData.fromAddress}}"}),' in your template will expand as "0x123"\nin the example above.']}),"\n"]}),"\n",(0,n.jsx)(t.h3,{id:"publish-secure",children:"Ensuring only wallet owners receive notifications"}),"\n",(0,n.jsxs)(t.p,{children:["To send a message to ",(0,n.jsx)(t.strong,{children:"only specific users"}),", also add the ",(0,n.jsx)(t.code,{children:"specificWallets"})," parameter,\nwhich is an array of wallet public key and blockchain name pairs - the message will be sent\nto all of these:"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-javascript",children:'await client.publishFusionMessage(token, [{\n    eventTypeId: "abc123",\n    variablesJson: {\n        fromAddress: "0x123abc",\n        amount: 250\n    },\n    specificWallets: [\n        {\n            walletPublicKey: "0x123abc",\n            walletBlockchain: "ETHEREUM"\n        },\n        {\n            walletPublicKey: "c123ABC",\n            walletBlockchain: "SOLANA"\n        }\n    ]\n}]);\n'})}),"\n",(0,n.jsx)(t.p,{children:"Note that wallet addresses should be converted to lowercase when submitting them\nhere, except for Solana addresses, which are case-sensitive."}),"\n",(0,n.jsx)(t.h3,{id:"requirements-for-topics-that-have-alert-filters",children:"Requirements for topics that have alert filters"}),"\n",(0,n.jsx)(t.p,{children:"When creating a new topic, the developer can specify which filters apply, and which parameters are collected either from the user, or programmatically on the frontend via variables that are set. This is in addition to the subscription value that is set for the alert. When a new alert is created, it will specify which thresholds the user wants the alert to trigger on. When publishing a new message via publishFusionMessage, you need to provide a JSON object named 'filterVariables' that is a child of your root 'variablesJson'. Let's use a couple examples."}),"\n",(0,n.jsx)(t.h4,{id:"topic-that-emits-eth-balance-changes",children:"Topic that emits ETH balance changes"}),"\n",(0,n.jsxs)(t.p,{children:["Topic Id: ",(0,n.jsx)(t.strong,{children:"abcdef123456"}),(0,n.jsx)("br",{}),"\nSubscription data: (default) Wallet address collected from connected wallet or input field for ",(0,n.jsx)(t.a,{href:"/docs/create-topics/api-triggered#topic-data",children:"subscription value"}),(0,n.jsx)("br",{}),"\nAdditional filters: ",(0,n.jsx)(t.strong,{children:(0,n.jsx)(t.a,{href:"/docs/alert-trigger/alert-filters/#abovethreshold",children:"aboveThreshold"})}),(0,n.jsx)("br",{})]}),"\n",(0,n.jsx)(t.p,{children:"If using the Notifi React module on your site, user subscriptions to this topic will create an alert that contain the wallet address that the alert should be triggered on, along with the threshold that it should trigger on. For this example, let's say that's wallet 0xa4d2c123 and the threshold is a decimal value of 1.3"}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.strong,{children:"Note: The filterVariables object is expected to be a child of the variablesJson root that you are providing"})}),"\n",(0,n.jsx)(t.h5,{id:"this-shows-a-case-where-this-users-alert-would-get-triggered-by-your-backend-publishing-a-message-the-subscription-value-matches-ignoring-case-and-the-threshold-value-is-above-what-the-alert-was-configured-for-if-either-of-those-conditions-failed-the-alert-would-not-trigger",children:"This shows a case where this user's alert would get triggered by your backend publishing a message. The subscription value matches (ignoring case) and the threshold value is above what the alert was configured for. If either of those conditions failed, the alert would not trigger."}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-javascript",children:'await client.publishFusionMessage(token, [{\n    eventTypeId: "abcdef123456",\n    variablesJson: {\n        someCustomValue: "foo",\n        someMoreCustom: {\n            moreEventSpecificData: "blah",\n        },\n        ...\n        filterVariables: {\n            subscription: {\n                value: "0xA4d2C123",\n                isCaseSensitive: false\n            },\n            aboveThreshold: {\n                thresholdComparisonValue: 1.31\n            }\n        }\n    }\n}]);\n'})}),"\n",(0,n.jsx)(t.h4,{id:"topic-that-emits-sensitive-account-updates",children:"Topic that emits sensitive account updates"}),"\n",(0,n.jsxs)(t.p,{children:["For cases where you'd like to send secure messages where only the wallet owner can receive the message, but still apply filters, we recommend setting the ",(0,n.jsx)(t.a,{href:"/docs/create-topics/api-triggered#topic-data",children:"subscription value"}),' to "No input". In these cases, you will always provide specific wallet owners that notifications are intended for. If there are additional alert filters configured, values must still be provided for them.']}),"\n",(0,n.jsxs)(t.p,{children:["Topic Id: ",(0,n.jsx)(t.strong,{children:"123456abcdef"}),(0,n.jsx)("br",{}),"\nSubscription data: ",(0,n.jsx)(t.strong,{children:(0,n.jsx)(t.a,{href:"/docs/create-topics/api-triggered#topic-data",children:"No Input"})}),(0,n.jsx)("br",{}),"\nAdditional filters: ",(0,n.jsx)(t.strong,{children:(0,n.jsx)(t.a,{href:"/docs/alert-trigger/alert-filters/#abovethreshold",children:"aboveThreshold"})}),(0,n.jsx)("br",{})]}),"\n",(0,n.jsx)(t.h5,{id:"this-shows-a-case-where-this-users-alert-would-get-triggered-by-your-backend-publishing-a-message-an-alert-matching-the-eventtypeid-that-you-provided-was-found-for-the-user-owning-wallet-0xa4d2c123-finally-the-threshold-value-is-above-what-the-alert-was-configured-for-so-the-alert-will-trigger-if-multiple-specificwallets-were-to-be-provided-all-of-those-users-would-have-alerts-searched-for-matching-the-criteria",children:"This shows a case where this user's alert would get triggered by your backend publishing a message. An alert matching the eventTypeId that you provided was found for the user owning wallet 0xA4d2C123. Finally, the threshold value is above what the alert was configured for, so the alert will trigger. If multiple 'specificWallets' were to be provided, all of those users would have alerts searched for matching the criteria."}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-javascript",children:'await client.publishFusionMessage(token, [{\n    eventTypeId: "123456abcdef",\n    variablesJson: {\n        ...\n        filterVariables: {\n            aboveThreshold: {\n                thresholdComparisonValue: 1.31\n            }\n        },\n    },\n    specificWallets: [\n        {\n            walletPublicKey: "0xA4d2C123",\n            walletBlockchain: "ETHEREUM"\n        },\n    ]\n}]);\n'})})]})}function d(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(c,{...e})}):c(e)}},8453:(e,t,i)=>{i.d(t,{R:()=>r,x:()=>o});var n=i(6540);const s={},a=n.createContext(s);function r(e){const t=n.useContext(a);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),n.createElement(a.Provider,{value:t},e.children)}}}]);